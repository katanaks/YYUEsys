<!DOCTYPE html>
<html>

<!-- head 开始 -->

<head>
    <meta charset="utf-8">
    <title>YYUEsys</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <link href="/static/layuiadmin/layui/css/layui.css" media="all" rel="stylesheet">
    <style>
        body {
            padding-top: 10px;
            background-color: #f5f5f5
        }
    </style>
</head>
<!-- head结束 -->

<body>

<div class="layui-fluid">

    <!-- 输入表单 开始 -->
    <form class="layui-form layui-form-pane">
        <!-- 隐藏ID -->
        <div class="layui-form-item" style="display:none;">
            <label class="layui-form-label">ID</label>
            <div class="layui-input-block">
                <input autocomplete="off" class="layui-input" maxlength="32" name="id" placeholder="" type="text"
                       value="{{.ID}}">
            </div>
        </div>


        <!-- 合同名称 签约职员-->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">合同名称</label>
                <div class="layui-input-inline">
                    <select lay-filter="Contract" lay-verify="required" name="Contract">
                        {{range .ContractList}}
                        {{if compare .ID $.ContractSelected}}
                        <option selected="true" value={{.ID}}>{{.Name}}</option>
                        {{else}}
                        <option value={{.ID}}>{{.Name}}</option>
                        {{end}}
                        {{end}}
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">签约职员</label>
                <div class="layui-input-inline">
                    <select lay-filter="Staff" name="Staff">
                        {{range .StaffList}}
                        {{if compare .ID $.StaffSelected}}
                        <option selected="true" value={{.ID}}>{{.Name}}</option>
                        {{else}}
                        <option value={{.ID}}>{{.Name}}</option>
                        {{end}}
                        {{end}}
                    </select>
                </div>
            </div>
        </div>

        <!-- 起始时间 到期时间 -->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">起始时间</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" id="Durationstart" lay-verify="date"
                           name="Durationstart" placeholder="请选择" type="text" value="{{.Durationstart}}">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">到期时间</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" id="Durationend" lay-verify="date"
                           name="Durationend" placeholder="请选择" type="text" value="{{.Durationend}}">
                </div>
            </div>
        </div>

        <!-- 折扣 实际支付-->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label" style="color: gray;">预设价格</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" id="Price" lay-verify="required|number"
                           name="Price" readonly="readonly" style="color: gray;" type="text"
                           value="{{.Price}}">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">支付金额</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" lay-verify="required|number" name="Paid" type="text"
                           value="{{.Paid}}">
                </div>
            </div>
        </div>
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 0px;">
            <legend style="font-size:12px;">会员基本信息</legend>
        </fieldset>

        <!-- 姓名 性别 -->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" lay-verify="required" name="Name" type="text"
                           value="{{.Name}}">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <input checked="" name="Gender" title="女" type="radio" value="女">
                    <input .Gender compare name="Gender" title="男" type="radio" value="男" {{if "男"}} checked=""
                    {{end}}>
                </div>
            </div>
        </div>
        <!-- 出生年月 身份证 -->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">出生年月</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" id="Birthday" lay-verify="date" name="Birthday"
                           placeholder="请选择" type="text" value="{{.Birthday}}">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">身份证号</label>
                <div class="layui-input-block">
                    <input autocomplete="off" class="layui-input" lay-verify="required" name="Idcard" style="width: 200px;"
                           type="text" value="{{.Idcard}}">
                </div>
            </div>
        </div>

        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 0px;">
            <legend style="font-size:12px;">联系人信息</legend>
        </fieldset>

        <!-- 姓名 关系 -->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">姓名</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" lay-verify="required" name="Contactname"
                           type="text" value="{{.Contactname}}">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">关系</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" lay-verify="required"
                           name="Contractrelationship" style="width: 200px;" type="text" value="{{.Contractrelationship}}">
                </div>
            </div>
        </div>
        <!-- 联系人身份证 -->
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">联系电话</label>
                <div class="layui-input-inline">
                    <input autocomplete="off" class="layui-input" lay-verify="required" name="Contacttelephone"
                           type="text" value="{{.Contacttelephone}}">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">身份证号</label>
                <div class="layui-input-block">
                    <input autocomplete="off" class="layui-input" lay-verify="required" name="Contactidcard"
                           style="width: 200px;" type="text" value="{{.Contactidcard}}">
                </div>
            </div>
        </div>
        <!-- 备注 -->
        <div class="layui-form-item">
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block" heith="100px">
                        <textarea class="layui-textarea" maxlength="1024" name="Memo"
                                  placeholder="">{{.Memo}}</textarea>
                </div>
            </div>
        </div>

        <!-- 提交 -->
        <input class="layui-btn" id="form-submit" lay-filter="submit" lay-submit="" style="display:none;"/>
    </form>
    <!-- 输入表单 结束 -->
</div>

<script charset="utf-8" src="/static/layuiadmin/layui/layui.all.js"></script>

<script>
    layui.use(['form', 'layer', 'jquery', 'layedit', 'laydate'],
        function () {
            $ = layui.jquery;
            var form = layui.form,
                layer = layui.layer,
                layedit = layui.layedit,
                laydate = layui.laydate;

            form.on('submit(submit)', function () {
                $.ajax({
                    type: "POST",
                    url: "/members/save",
                    async: true,
                    data: $('form').serialize(),
                    datatype: 'json',
                    success: function (rs) {
                        if (rs.code == 200) {
                            // console.log(data);
                            layer.msg("保存成功", {
                                    icon: 6,
                                    time: 600
                                },
                                function () {
                                    var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                    parent.layer.close(index); //执行关闭
                                    // parent.$(".layui-laypage-btn").click(); //刷新表格
                                    parent.layui.table.reload("data_table");
                                });

                        } else {
                            layer.msg(rs.msg, {
                                icon: 5,
                                time: 1000
                            });
                        }
                    }
                })
                return false;
            });

            // 输入时刷新
            form.on('select(Contract)', function (sel) {
                console.log(sel.value);
                $.ajax({
                    url: '/members/getpredata?ID=' + sel.value,
                    success: function (predata) {

                        $("#Durationstart").val(predata.prestart);
                        $("#Durationend").val(predata.preend);
                        $("#Price").val(predata.Price);
                        $("#Paid").val(predata.Price);


                    }
                });
            });

            //日期
            laydate.render({
                elem: '#Birthday'
            });
            laydate.render({
                elem: '#Durationstart'
            });
            laydate.render({
                elem: '#Durationend'
            });
        });
</script>

</body>

</html>